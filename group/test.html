<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <script>
      var countSmaller = function(nums) {
        const arr = Array.from({ length: nums.length }, (_, index) => index);
        const res = new Array(nums.length).fill(0);
        merge(arr);
        return res;
        function merge(arr) {
          if (arr.length < 2) return arr;
          const mid = arr.length >> 1;
          const left = arr.slice(0, mid);
          const right = arr.slice(mid);
          return mergeSort(merge(left), merge(right));
        }
        function mergeSort(left, right) {
          let newArr = [];
          let leftIdx = 0;
          let rightIdx = 0;
          while(leftIdx < left.length && rightIdx < right.length) {
            const leftVal = nums[ left[ leftIdx ] ]
            const rightVal = nums[ right[ rightIdx ] ]
            if (leftVal > rightVal) {
              res[ left[ leftIdx ] ] += (right.length - rightIdx);
              newArr.push(left[ leftIdx ]);
              leftIdx++;
            } else {
              newArr.push(right[ rightIdx ]);
              rightIdx++;
            }
          }
          if (leftIdx < left.length) {
            newArr = newArr.concat(left.slice(leftIdx));
          } else {
            newArr = newArr.concat(right.slice(rightIdx));
          }
          return newArr;
        }
      };
      console.log(countSmaller([5,5,2,2]));
    </script>
  </body>
</html>
